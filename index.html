<!DOCTYPE html>
<html lang="en" class="h-100">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1, user-scalable=no">
    <title>DPIPT</title>
    <link rel="icon" href="https://dpi-pt.github.io/favicon.ico">
    <link rel="stylesheet" href="https://dpi-pt.github.io/css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="https://dpi-pt.github.io/css/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="https://dpi-pt.github.io/css/bootstrap-table/bootstrap-table.min.css">
  </head>

<body class="d-flex flex-column h-100">
<header class="bg-info">
    <nav class="navbar navbar-expand-lg navbar-dark bg-info">
        <div class="container">
            <a class="navbar-brand" href="https://ddi-pt.github.io/">&nbsp;<i class="fa fa-medkit" aria-hidden="true"></i></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample07" aria-controls="navbarsExample07" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarsExample07">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="https://ddi-pt.github.io/predict">&nbsp;&nbsp;&nbsp;Predict&nbsp;&nbsp;&nbsp;</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

    <main role="main" class="container flex-shrink-0">
        <br>
        <br>
<div class="row">

<div class="col-md-4">		
<div class="card">
  <div class="card-header">
    <i class="fa fa-tags" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Drug
  </div>
  <div class="card-body">
    <select id="op-d" class="custom-select">
        <option selected="selected" value="all">All drugs</option>
        <option value="selected">Selected drugs</option>
    </select>
	
<div id="s-d" style="display: none;">
<div class="row mt-3">
  <div class="col-8 offset-2">
    <button type="button" class="btn btn-outline-info btn-block" type="button" data-toggle="modal" data-target="#Modal-d">Add</button>
  </div>
  <div class="col-12">
      <ul class="list-group mt-3" id="d-l">

      </ul>
  </div>
</div>
</div>

  </div>
</div>
<br>
<br>
</div>

<div class="col-md-4">
<div class="card">
  <div class="card-header">
    <i class="fa fa-tags" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Protein
  </div>
  <div class="card-body">
    <select id="op-p" class="custom-select">
        <option selected="selected" value="all">All proteins</option>
        <option value="selected">Selected proteins</option>
    </select>
	
<div id="s-p" style="display: none;">
<div class="row mt-3">
  <div class="col-8 offset-2">
    <button type="button" class="btn btn-outline-info btn-block" type="button" data-toggle="modal" data-target="#Modal-p">Add</button>
  </div>
  <div class="col-12">
      <ul class="list-group mt-3" id="p-l">

      </ul>
  </div>
</div>
</div>
	
  </div>
</div>
<br>
<br>
</div>

<div class="col-md-4">
<div class="card">
  <div class="card-header">
    <i class="fa fa-tags" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Action
  </div>
  <div class="card-body">
    <select id="op-a" class="custom-select">
        <option selected="selected" value="all">All actions</option>
        <option value="selected">Selected actions</option>
    </select>
	
<div id="s-a" style="display: none;">
<div class="row mt-3">
  <div class="col-8 offset-2">
    <button type="button" class="btn btn-outline-info btn-block" type="button" data-toggle="modal" data-target="#Modal-a">Add</button>
  </div>
  <div class="col-12">
      <ul class="list-group mt-3" id="a-l">

      </ul>
  </div>
</div>
</div>
	
  </div>
</div>
<br>
<br>
</div>

</div>

            <div class="modal fade" id="Modal-d" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="ModalLabel">Selelct a drug</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div id="toolbar-d">
                                <button id="re-bt-d" class="btn btn-secondary">Reset</button>
                            </div>
                            <div class="table-responsive">
                                <table id="table-d"></table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-info" data-dismiss="modal" id="ok-d">OK</button>
                        </div>
                    </div>
                </div>
            </div>
			
            <div class="modal fade" id="Modal-p" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="ModalLabel">Selelct a protein</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div id="toolbar-p">
                                <button id="re-bt-p" class="btn btn-secondary">Reset</button>
                            </div>
                            <div class="table-responsive">
                                <table id="table-p"></table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-info" data-dismiss="modal" id="ok-p">OK</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="Modal-a" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="ModalLabel">Selelct an action</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div id="toolbar-a">
                                <button id="re-bt-a" class="btn btn-secondary">Reset</button>
                            </div>
                            <div class="table-responsive">
                                <table id="table-a"></table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-info" data-dismiss="modal" id="ok-a">OK</button>
                        </div>
                    </div>
                </div>
            </div>	
			
                    <div class="card">
                        <div class="card-header">
                            <i class="fa fa-table" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Result
                        </div>
                        <div class="card-body">
                            <div id="exptoolbar2">
                                <select id="sel_exp2" class="custom-select">
                                    <option selected="selected" value="selected">Export selected data</option>
                                    <option value="basic">Export data in this page</option>
                                    <option value="all">Export all data</option>
                                </select>
							</div>
                            <div class="table-responsive">
                                <table id="table-results"></table>
                            </div>
							<br>
                        </div>
                    </div>
        <br>
        <br>
    </main>

<footer class="footer mt-auto py-2 bg-info">
    <div class="container">
        <h4 class="text-white float-left m-1">DPIPT</h4>
		<div class="float-right">
        <small class="d-block text-muted mt-2">&copy; 2020&nbsp;&nbsp;&nbsp;<i class="fa fa-bug" aria-hidden="true"></i>&nbsp;Version 0.1</small>
		</div>
	</div>
</footer>

    <script src="https://dpi-pt.github.io/js/jquery/jquery.min.js"></script>
    <script src="https://dpi-pt.github.io/js/popper/popper.min.js"></script>
    <script src="https://dpi-pt.github.io/js/bootstrap/bootstrap.min.js"></script>
    <script src="https://dpi-pt.github.io/js/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="https://dpi-pt.github.io/js/tableExport/tableExport.min.js"></script>
    <script src="https://dpi-pt.github.io/js/bootstrap-table/extensions/export/bootstrap-table-export.min.js"></script>

    <script>	
        $('#table-results').bootstrapTable({
            contentType: 'application/x-www-form-urlencoded',
            toolbar: '#exptoolbar2',
            clickToSelect: true,
            showExport: true,
            exportDataType: 'selected',
            cache: true,
            striped: true,
            pagination: true,
            pageList: [10, 20, 50],
            pageSize: 10,
            pageNumber: 1,
            maintainMetaData: true,
            sidePagination: 'client',
            queryParams: function (params) {
                return {
                    pageSize: params.limit,
                    offset: params.offset,
                    sort: params.sort,
                    sortOrder: params.order,
                    _token: $('meta[name="csrf-token"]').attr('content'),
                    search: $('.search-input').val()
                }
            },
            sortName: 'score',
            sortOrder: 'desc',
            columns: [
                {
                    field: 'state',
                    checkbox: true,
                    align: 'center',
                }, {
                    field: 'drug',
                    title: 'Drug',
                    sortable:true,
                }, {
                    field: 'protein',
                    title: 'Protein',
                    sortable:true,
                }, {
                    field: 'action',
                    title: 'Action',
                    sortable:true,
                }, {
                    field: 'score',
                    title: 'Score',
                    sortable:true,
                }, {
                    field: 'type',
                    title: 'Type',
                    sortable:true,
                }
            ],
			formatNoMatches: function(){
                return "No result";
            },
        });
        $("#sel_exp2").change(function () {
            $('#table-results').bootstrapTable('refreshOptions', {
                exportDataType: $(this).val()
            });
        });
		
        $('#table-d').bootstrapTable({
            url: 'https://pharmpkdb.com:14488/model/browse_drug_d',
            contentType: 'application/x-www-form-urlencoded',
            toolbar: '#toolbar-d',
			toolbarAlign: 'right',
            clickToSelect: true,
            singleSelect: true,
            search: true,
			showSearchButton: true,
            searchAlign: 'left',
			maintainMetaData: true,
            cache: true,
            striped: true,
            pagination: true,
            pageList: [5, 10, 20],
            sidePagination: 'client',
            columns: [
                {
                    field: 'state',
                    checkbox: true,
                    align: 'center',
                }, {
                    field: 'drug_id',
                    title: 'Drug Id',
                    sortable:true,
                }, {
                    field: 'name',
                    title: 'Name',
                    sortable:true,
                },{
                    field: 'type',
                    title: 'Type',
                    sortable:true,
                }, {
                    field: 'cas_number',
                    title: 'Cas Number',
                    sortable:true,
                }
            ]
        });
		
		$(function(){
            $("#re-bt-d").click(function(){
                $("#table-d").bootstrapTable('resetSearch');
            });
        });
		
        var d_name;
        $(function(){
            $('#table-d').on('check.bs.table check-all.bs.table uncheck.bs.table uncheck-all.bs.table',
                function (e, rowsAfter, rowsBefore) {
                    var rows = rowsAfter;

                    if (e.type === 'uncheck-all') {
                        rows = rowsBefore;
                    };

                    d_name = $.map(!$.isArray(rows) ? [rows] : rows, function (row) {
                        return row.name;
                    });
                });
        });
		
		var sel_d = [];
		
        $(function(){
            $("#ok-d").click(function(){
				if ($.inArray(d_name[0], sel_d) == -1) {
					sel_d.push(d_name[0]);
					$("#d-l").append("<li class='list-group-item'>" + d_name[0] + "<button type='button' class='close' onclick='delRow_d(this)'><span aria-hidden='true'>&times;</span></button></li>");
				} else {
					
				};
            });
        });
		
		$("#op-d").change(function () {
            if ($(this).val() == 'selected') {
				$("#s-d").show();
			} else if ($(this).val() == 'all'){
				$("#s-d").hide();
				$("#d-l").empty();
				sel_d = [];
			};
        });
		
		function delRow_d(obj) {
			rd = $(obj).parent()[0].innerText;
			rd = rd.slice(0,rd.length-2);
			sel_d.forEach(function(item, index, arr) {
				if(item === rd) {
					arr.splice(index, 1);
				}
			});
            $(obj).parent().remove();
        };
		
		$('#table-p').bootstrapTable({
            url: 'https://pharmpkdb.com:14488/model/browse_drug_p',
            contentType: 'application/x-www-form-urlencoded',
            toolbar: '#toolbar-p',
			toolbarAlign: 'right',
            clickToSelect: true,
            singleSelect: true,
            search: true,
			showSearchButton: true,
            searchAlign: 'left',
			maintainMetaData: true,
            cache: true,
            striped: true,
            pagination: true,
            pageList: [5, 10, 20],
            sidePagination: 'client',
            columns: [
                {
                    field: 'state',
                    checkbox: true,
                    align: 'center',
                }, {
                    field: 'protein_id',
                    title: 'Protein Id',
                    sortable:true,
                }, {
                    field: 'protein_type',
                    title: 'Protein Type',
                    sortable:true,
                },{
                    field: 'protein_name',
                    title: 'Protein Name',
                    sortable:true,
                }, {
                    field: 'organism',
                    title: 'Organism',
                    sortable:true,
                },{
                    field: 'gene_symbol',
                    title: 'Gene Symbol',
                    sortable:true,
                }, {
                    field: 'uniprot_id',
                    title: 'Uniprot Id',
                    sortable:true,
                }
            ]
        });
		
		$(function(){
            $("#re-bt-p").click(function(){
                $("#table-p").bootstrapTable('resetSearch');
            });
        });
		
        var p_name;
        $(function(){
            $('#table-p').on('check.bs.table check-all.bs.table uncheck.bs.table uncheck-all.bs.table',
                function (e, rowsAfter, rowsBefore) {
                    var rows = rowsAfter;

                    if (e.type === 'uncheck-all') {
                        rows = rowsBefore;
                    };

                    p_name = $.map(!$.isArray(rows) ? [rows] : rows, function (row) {
                        return row.protein_name;
                    });
                });
        });
		
		var sel_p = [];
		
        $(function(){
            $("#ok-p").click(function(){
				if ($.inArray(p_name[0], sel_p) == -1) {
					sel_p.push(p_name[0]);
					$("#p-l").append("<li class='list-group-item'>" + p_name[0] + "<button type='button' class='close' onclick='delRow_p(this)'><span aria-hidden='true'>&times;</span></button></li>");
				} else {
					
				};
            });
        });
		
		$("#op-p").change(function () {
            if ($(this).val() == 'selected') {
				$("#s-p").show();
			} else if ($(this).val() == 'all'){
				$("#s-p").hide();
				$("#p-l").empty();
				sel_p = [];
			};
        });
		
		function delRow_p(obj) {
			rd = $(obj).parent()[0].innerText;
			rd = rd.slice(0,rd.length-2);
			sel_p.forEach(function(item, index, arr) {
				if(item === rd) {
					arr.splice(index, 1);
				}
			});
            $(obj).parent().remove();
        };
		
		$('#table-a').bootstrapTable({
            url: 'https://pharmpkdb.com:14488/model/browse_drug_a',
            contentType: 'application/x-www-form-urlencoded',
            toolbar: '#toolbar-a',
			toolbarAlign: 'right',
            clickToSelect: true,
            singleSelect: true,
            search: true,
			showSearchButton: true,
            searchAlign: 'left',
			maintainMetaData: true,
            cache: true,
            striped: true,
            pagination: true,
            pageList: [5, 10, 20],
			uniqueId: 'DrugBank-Id',
            sidePagination: 'client',
            columns: [
                {
                    field: 'state',
                    checkbox: true,
                    align: 'center',
                }, {
                    field: 'action',
                    title: 'Action',
                    sortable:true,
					align: 'center',
                }
            ]
        });
		
		$(function(){
            $("#re-bt-a").click(function(){
                $("#table-a").bootstrapTable('resetSearch');
            });
        });
		
        var a_name;
        $(function(){
            $('#table-a').on('check.bs.table check-all.bs.table uncheck.bs.table uncheck-all.bs.table',
                function (e, rowsAfter, rowsBefore) {
                    var rows = rowsAfter;

                    if (e.type === 'uncheck-all') {
                        rows = rowsBefore;
                    };

                    a_name = $.map(!$.isArray(rows) ? [rows] : rows, function (row) {
                        return row.action;
                    });
                });
        });
		
		var sel_a = [];
		
        $(function(){
            $("#ok-a").click(function(){
				if ($.inArray(a_name[0], sel_a) == -1) {
					sel_a.push(a_name[0]);
					$("#a-l").append("<li class='list-group-item'>" + a_name[0] + "<button type='button' class='close' onclick='delRow_a(this)'><span aria-hidden='true'>&times;</span></button></li>");
				} else {
					
				};
            });
        });
		
		$("#op-a").change(function () {
            if ($(this).val() == 'selected') {
				$("#s-a").show();
			} else if ($(this).val() == 'all'){
				$("#s-a").hide();
				$("#a-l").empty();
				sel_a = [];
			};
        });
		
		function delRow_a(obj) {
			rd = $(obj).parent()[0].innerText;
			rd = rd.slice(0,rd.length-2);
			sel_a.forEach(function(item, index, arr) {
				if(item === rd) {
					arr.splice(index, 1);
				}
			});
            $(obj).parent().remove();
        };
		
		
		var flag_a;
		var flag_b;
		var check_l = [];
		
		$.get('https://www.pharmpkdb.com:14488/model/check', function(data){
			$.each(data, function (i, d) {
				check_l.push(d);
			})
			
		});
		
		$(function(){
		$('#s').click(function (e) {
            e.preventDefault();
			var d_a = String($('#drug-a').val()).toLowerCase();
			var d_b = String($('#drug-b').val()).toLowerCase();
			if (d_a == '' && d_b == '') {
				$("#drug-a").removeClass('is-valid');
				$("#drug-a").addClass('is-invalid');
				$("#drug-b").removeClass('is-valid');
				$("#drug-b").addClass('is-invalid');
			} else if (d_a == d_b) {
				alert("Drug A and Drug B cannot be the same!");
				$('#drug-a').val('');
				$('#drug-b').val('');
			} else {
				if ($.inArray(d_a, check_l) == -1) {
					$("#drug-a").removeClass('is-valid');
					$("#drug-a").addClass('is-invalid');
					flag_a = 0;
				} else {
					$("#drug-a").removeClass('is-invalid');
					$("#drug-a").addClass('is-valid');
					flag_a = 1;
				};
				if ($.inArray(d_b, check_l) == -1) {
					$("#drug-b").removeClass('is-valid');
					$("#drug-b").addClass('is-invalid');
					flag_b = 0;
				} else {
					$("#drug-b").removeClass('is-invalid');
					$("#drug-b").addClass('is-valid');
					flag_b = 1;
				};
				
				if (flag_a == 1 && flag_b == 1) {
					$('#table-known').bootstrapTable('refreshOptions', {
						url: 'https://pharmpkdb.com:14488/model/known',
						method: 'post',
						queryParams: function (params) {
							return {
								drug_a: d_a,
								drug_b: d_b
							}
						},
					});
					$('#table-results').bootstrapTable('refreshOptions', {
						url: 'https://pharmpkdb.com:14488/model/predict',
						method: 'post',
						queryParams: function (params) {
							return {
								drug_a: d_a,
								drug_b: d_b
							}
						},
					});
				};
			};
		});
		});
		
    </script>
</body>
</html>
